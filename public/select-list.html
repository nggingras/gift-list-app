<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Select Gift List</title>
    <link rel="stylesheet" href="select-list_styles.css">
</head>
<body>
    <header>
        <h1>Select a Gift List</h1>
    </header>

    <main>
        <ul id="giftLists">
            <!-- Gift lists will be populated here -->
        </ul>

        <input type="text" id="newListName" placeholder="New list name">
        <input type="password" id="newListPassword" placeholder="Password">
        <button onclick="addGiftList()">Add List</button>
    </main>

    <footer>
        <p>&copy; 2023 Gift List App</p>
    </footer>

    <script>
        async function loadGiftLists() {
            const response = await fetch('/gift-lists');
            const giftLists = await response.json();
            const giftListsContainer = document.getElementById('giftLists');
            giftListsContainer.innerHTML = ''; // Clear the list

            giftLists.forEach(list => {
                const li = document.createElement('li');
                li.className = 'gift-list-item';

                const listName = document.createElement('span');
                listName.textContent = list.name;
                listName.className = 'list-name';

                const viewButton = document.createElement('button');
                viewButton.textContent = 'View';
                viewButton.className = 'view-button';
                viewButton.onclick = async () => {
                    if (list.disableReservations) {
                        alert('Le créateur n\'a pas encore activé la liste.');
                    } else {
                        if (confirm('Es-tu certain de vouloir ouvrir la liste ? Tu pourras voir les cadeaux qui sont réservés.')) {
                            window.location.href = `index.html?listId=${list.id}&mode=view&directAccess=false`;
                        }
                    }
                };

                const modifyButton = document.createElement('button');
                modifyButton.textContent = 'Modify';
                modifyButton.className = 'modify-button';
                modifyButton.onclick = () => {
                    window.location.href = `index.html?listId=${list.id}&mode=modify&directAccess=false`;
                };

                li.appendChild(listName);
                li.appendChild(viewButton);
                li.appendChild(modifyButton);
                giftListsContainer.appendChild(li);
            });
        }

        async function addGiftList() {
            const newListName = document.getElementById('newListName').value;
            const newListPassword = document.getElementById('newListPassword').value;
            if (newListName && newListPassword) {
                await fetch('/gift-lists', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name: newListName, password: newListPassword })
                });
                document.getElementById('newListName').value = '';
                document.getElementById('newListPassword').value = '';
                loadGiftLists(); // Refresh the list after adding a new list
            }
        }

        window.onload = loadGiftLists;
    </script>
</body>
</html>